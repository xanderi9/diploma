{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\79131\\\\OneDrive\\\\\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B\\\\\\u0445\\u043B\\u0430\\u043C\\\\react project\\\\client\\\\src\\\\components\\\\Modals\\\\ScheduleFQWModal\\\\GenerateTask.js\",\n  _s = $RefreshSig$();\nimport React, { useState } from 'react';\nimport petrovich from 'petrovich';\nimport RussianNouns from 'russian-nouns-js';\nimport { saveAs } from 'file-saver';\nimport PizZip from 'pizzip';\nimport Docxtemplater from 'docxtemplater';\nimport word from './3.docx';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Modal = ({\n  message,\n  onClose\n}) => /*#__PURE__*/_jsxDEV(\"div\", {\n  className: \"modal\",\n  children: /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"modal-content\",\n    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"close\",\n      onClick: onClose,\n      children: \"\\xD7\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 12,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: message\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 13,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 11,\n    columnNumber: 5\n  }, this)\n}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 10,\n  columnNumber: 3\n}, this);\n_c = Modal;\nconst GenerateTask = ({\n  data,\n  request_data_task,\n  schedule_stud_prof,\n  teacher_ei\n}) => {\n  _s();\n  const [modalMessage, setModalMessage] = useState('');\n  const handleGenerateTask = async () => {\n    if (!data.user.first_name || !data.user.last_name || !data.user.patronymic) {\n      setModalMessage('ФИО неполное. Все поля ФИО должны быть заполнены.');\n      return;\n    }\n    if (schedule_stud_prof.length === 0) {\n      setModalMessage('График отсутствует. График должен быть заполнен.');\n      return;\n    }\n    const person = {\n      first: data.user.first_name,\n      middle: data.user.patronymic,\n      last: data.user.last_name\n    };\n    const fio = petrovich(person, 'dative');\n    const rne = new RussianNouns.Engine();\n    function getInitials(firstName, patronymic) {\n      return `${firstName.charAt(0)}.${patronymic.charAt(0)}.`;\n    }\n    const np_s = getInitials(data.user.first_name, data.user.patronymic);\n    const np_t = getInitials(request_data_task.teacher.first_name, request_data_task.teacher.patronymic);\n    const year = new Date().getFullYear();\n    const declineWord = (word, gender) => rne.decline({\n      text: word.split(' ')[0],\n      gender\n    }, 'родительный');\n    let place_of_work = teacher_ei.place_of_work ? teacher_ei.place_of_work.replace(teacher_ei.place_of_work.split(' ')[0], declineWord(teacher_ei.place_of_work.split(' ')[0], 'женский')) : '';\n    try {\n      const response = await fetch(word);\n      if (!response.ok) throw new Error('Ошибка сети');\n      const arrayBuffer = await response.arrayBuffer();\n      const zip = new PizZip(arrayBuffer);\n      const doc = new Docxtemplater(zip);\n      const dataToRender = {\n        year: year,\n        dat_student_last_name: fio.last,\n        student_last_name: data.user.last_name,\n        student_first_name: fio.first,\n        student_patronymic: fio.middle,\n        group_name: data.group.name,\n        speciality_code: data.group.specialty.code,\n        speciality_name: data.group.specialty.name,\n        profile_code: data.group.specialty.field_of_study.code,\n        profile_name: data.group.specialty.field_of_study.name,\n        theme_name: request_data_task.theme.name,\n        np_s: np_s,\n        np_t: np_t,\n        teacher_last_name: request_data_task.teacher.last_name,\n        job_title: teacher_ei.job_title,\n        place_of_work: place_of_work,\n        schedule_stud_prof: schedule_stud_prof.map(stage => ({\n          stage_name: stage.stage_name,\n          start: stage.start,\n          end: stage.end ? '-' + stage.end : '',\n          result: stage.result,\n          completion_mark: stage.completion_mark ? 'Выполнено' : 'не выполнено'\n        }))\n      };\n      doc.setData(dataToRender);\n      doc.render();\n      const output = doc.getZip().generate({\n        type: 'blob'\n      });\n      saveAs(output, `Задание на ВКР ${data.user.last_name}.docx`);\n    } catch (error) {\n      console.error('Ошибка загрузки файла:', error);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleGenerateTask,\n      children: \"Generate Task\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 7\n    }, this), modalMessage && /*#__PURE__*/_jsxDEV(Modal, {\n      message: modalMessage,\n      onClose: () => setModalMessage('')\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 24\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 100,\n    columnNumber: 5\n  }, this);\n};\n_s(GenerateTask, \"Qahunj8l8jdNS8knS647o5Rbg2M=\");\n_c2 = GenerateTask;\nexport default GenerateTask;\nvar _c, _c2;\n$RefreshReg$(_c, \"Modal\");\n$RefreshReg$(_c2, \"GenerateTask\");","map":{"version":3,"names":["React","useState","petrovich","RussianNouns","saveAs","PizZip","Docxtemplater","word","jsxDEV","_jsxDEV","Modal","message","onClose","className","children","onClick","fileName","_jsxFileName","lineNumber","columnNumber","_c","GenerateTask","data","request_data_task","schedule_stud_prof","teacher_ei","_s","modalMessage","setModalMessage","handleGenerateTask","user","first_name","last_name","patronymic","length","person","first","middle","last","fio","rne","Engine","getInitials","firstName","charAt","np_s","np_t","teacher","year","Date","getFullYear","declineWord","gender","decline","text","split","place_of_work","replace","response","fetch","ok","Error","arrayBuffer","zip","doc","dataToRender","dat_student_last_name","student_last_name","student_first_name","student_patronymic","group_name","group","name","speciality_code","specialty","code","speciality_name","profile_code","field_of_study","profile_name","theme_name","theme","teacher_last_name","job_title","map","stage","stage_name","start","end","result","completion_mark","setData","render","output","getZip","generate","type","error","console","_c2","$RefreshReg$"],"sources":["C:/Users/79131/OneDrive/Рабочий стол/хлам/react project/client/src/components/Modals/ScheduleFQWModal/GenerateTask.js"],"sourcesContent":["import React, { useState } from 'react';\r\nimport petrovich from 'petrovich';\r\nimport RussianNouns from 'russian-nouns-js';\r\nimport { saveAs } from 'file-saver';\r\nimport PizZip from 'pizzip';\r\nimport Docxtemplater from 'docxtemplater';\r\nimport word from './3.docx';\r\n\r\nconst Modal = ({ message, onClose }) => (\r\n  <div className=\"modal\">\r\n    <div className=\"modal-content\">\r\n      <span className=\"close\" onClick={onClose}>&times;</span>\r\n      <p>{message}</p>\r\n    </div>\r\n  </div>\r\n);\r\n\r\nconst GenerateTask = ({ data, request_data_task, schedule_stud_prof, teacher_ei }) => {\r\n  const [modalMessage, setModalMessage] = useState('');\r\n\r\n  const handleGenerateTask = async () => {\r\n    if (!data.user.first_name || !data.user.last_name || !data.user.patronymic) {\r\n      setModalMessage('ФИО неполное. Все поля ФИО должны быть заполнены.');\r\n      return;\r\n    }\r\n\r\n    if (schedule_stud_prof.length === 0) {\r\n      setModalMessage('График отсутствует. График должен быть заполнен.');\r\n      return;\r\n    }\r\n\r\n    const person = {\r\n      first: data.user.first_name,\r\n      middle: data.user.patronymic,\r\n      last: data.user.last_name,\r\n    };\r\n    const fio = petrovich(person, 'dative');\r\n    const rne = new RussianNouns.Engine();\r\n\r\n    function getInitials(firstName, patronymic) {\r\n      return `${firstName.charAt(0)}.${patronymic.charAt(0)}.`;\r\n    }\r\n\r\n    const np_s = getInitials(data.user.first_name, data.user.patronymic);\r\n    const np_t = getInitials(request_data_task.teacher.first_name, request_data_task.teacher.patronymic);\r\n    const year = new Date().getFullYear();\r\n    const declineWord = (word, gender) => rne.decline({ text: word.split(' ')[0], gender }, 'родительный');\r\n\r\n    let place_of_work = teacher_ei.place_of_work\r\n      ? teacher_ei.place_of_work.replace(\r\n          teacher_ei.place_of_work.split(' ')[0],\r\n          declineWord(teacher_ei.place_of_work.split(' ')[0], 'женский')\r\n        )\r\n      : '';\r\n\r\n    try {\r\n      const response = await fetch(word);\r\n      if (!response.ok) throw new Error('Ошибка сети');\r\n      const arrayBuffer = await response.arrayBuffer();\r\n      const zip = new PizZip(arrayBuffer);\r\n      const doc = new Docxtemplater(zip);\r\n\r\n      const dataToRender = {\r\n        year: year,\r\n        dat_student_last_name: fio.last,\r\n        student_last_name: data.user.last_name,\r\n        student_first_name: fio.first,\r\n        student_patronymic: fio.middle,\r\n        group_name: data.group.name,\r\n        speciality_code: data.group.specialty.code,\r\n        speciality_name: data.group.specialty.name,\r\n        profile_code: data.group.specialty.field_of_study.code,\r\n        profile_name: data.group.specialty.field_of_study.name,\r\n        theme_name: request_data_task.theme.name,\r\n        np_s: np_s,\r\n        np_t: np_t,\r\n        teacher_last_name: request_data_task.teacher.last_name,\r\n        job_title: teacher_ei.job_title,\r\n        place_of_work: place_of_work,\r\n        schedule_stud_prof: schedule_stud_prof.map(stage => ({\r\n          stage_name: stage.stage_name,\r\n          start: stage.start,\r\n          end: stage.end ? '-' + stage.end : '',\r\n          result: stage.result,\r\n          completion_mark: stage.completion_mark ? 'Выполнено' : 'не выполнено',\r\n        })),\r\n      };\r\n\r\n      doc.setData(dataToRender);\r\n      doc.render();\r\n\r\n      const output = doc.getZip().generate({ type: 'blob' });\r\n      saveAs(output, `Задание на ВКР ${data.user.last_name}.docx`);\r\n    } catch (error) {\r\n      console.error('Ошибка загрузки файла:', error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <button onClick={handleGenerateTask}>Generate Task</button>\r\n      {modalMessage && <Modal message={modalMessage} onClose={() => setModalMessage('')} />}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default GenerateTask;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}