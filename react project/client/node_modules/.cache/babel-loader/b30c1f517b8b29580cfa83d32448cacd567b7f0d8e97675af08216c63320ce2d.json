{"ast":null,"code":"import petrovich from 'petrovich';\nimport { saveAs } from 'file-saver';\nimport PizZip from 'pizzip';\nimport Docxtemplater from 'docxtemplater';\nimport word from './protocol.docx';\nconst generateProtocolsFunction = async ({\n  composition_of_sec,\n  selectedGroup,\n  groupData,\n  data,\n  requests\n}) => {\n  // Извлекаем председателя и членов СЭК\n  const chairman = composition_of_sec.member_of_SEC.find(comp => comp.chairman_of_SEC === true);\n  const members_list = composition_of_sec.member_of_SEC.filter(sec => sec.chairman_of_SEC === false);\n  try {\n    // Загружаем шаблон документа\n    const response = await fetch(word); // Путь к вашему файлу шаблона\n    if (!response.ok) throw new Error('Ошибка сети');\n    const arrayBuffer = await response.arrayBuffer();\n\n    // Проходимся по каждому элементу groupData (предполагаем, что это массив)\n    for (const item of groupData) {\n      const request = requests.request_list.find(req => req.student.username === item.student.user.username);\n      if (!request) {\n        console.warn(`Для студента ${item.student.last_name} ${item.student.first_name} не найдена принятая заявка.`);\n        continue; // Пропускаем студента без принятой заявки\n      }\n      const personalProtection = requests.personal_work_protection_list.find(pp => pp.request === request.id);\n      if (!personalProtection) {\n        console.warn(`Для студента ${item.student.last_name} ${item.student.first_name} не найдена персональная защита.`);\n        continue; // Пропускаем студента без персональной защиты\n      }\n      const generalProtection = requests.general_work_protection_list.find(gp => gp.id === personalProtection.work_protection);\n      if (!generalProtection) {\n        console.warn(`Для студента ${item.student.last_name} ${item.student.first_name} не найдена общая защита.`);\n        continue; // Пропускаем студента без общей защиты\n      }\n      const teacher = request.teacher;\n      const theme = request.theme;\n\n      // Вычисляем время начала и окончания защиты\n      const [hours_start, min_start] = personalProtection.time.split(':');\n      const startTime = new Date();\n      startTime.setHours(hours_start);\n      startTime.setMinutes(min_start);\n      startTime.setMinutes(startTime.getMinutes() + 20);\n      const hours_end = startTime.getHours();\n      const min_end = startTime.getMinutes();\n\n      // Формируем объект с данными для подстановки в шаблон\n      const dataToRender = {\n        protocol_number: generalProtection.protocol_number,\n        group_protection_date: new Date(generalProtection.date).toLocaleDateString('ru-RU'),\n        hours_start: hours_start,\n        min_start: min_start,\n        hours_end: hours_end,\n        min_end: min_end,\n        chairman_last_name: chairman.user.last_name,\n        chairman_np: getInitials(chairman.user.first_name, chairman.user.patronymic),\n        chairman_degree: chairman.employee_information.academic_degree,\n        chairman_job_title: chairman.employee_information.job_title,\n        members_list: members_list.map(member => ({\n          members_last_name: member.user.last_name,\n          members_np: getInitials(member.user.first_name, member.user.patronymic),\n          members_degree: member.employee_information.academic_degree || '',\n          members_job_title: member.employee_information.job_title,\n          members_place_of_work: member.employee_information.place_of_work\n        })),\n        student_fullname: `${item.student.last_name} ${item.student.first_name} ${item.student.patronymic}`,\n        specialityCode: item.student.group.speciality.code,\n        specialtityProgram: item.student.group.speciality.name,\n        theme: theme ? theme.name : '',\n        teacher_last_name: teacher.last_name,\n        teacher_np: getInitials(teacher.first_name, teacher.patronymic),\n        teacher_degree: teacher.employee_information.academic_degree,\n        teacher_job_title: teacher.employee_information.job_title,\n        reviewer_last_name: theme && theme.reviewer ? theme.reviewer.user.last_name : '',\n        reviewer_np: theme && theme.reviewer ? getInitials(theme.reviewer.user.first_name, theme.reviewer.user.patronymic) : '',\n        reviewer_degree: theme && theme.reviewer ? theme.reviewer.employee_information.academic_degree : '',\n        reviewer_job_title: theme && theme.reviewer ? theme.reviewer.employee_information.job_title : '',\n        student_last_name: item.student.last_name,\n        student_np: getInitials(item.student.first_name, item.student.patronymic),\n        secretary_last_name: data.user.last_name,\n        secretary_np: getInitials(data.user.first_name, data.user.patronymic),\n        duration: 20\n      };\n\n      // Создаем новую инстанцию Docxtemplater для каждого студента\n      const zip = new PizZip(arrayBuffer);\n      const doc = new Docxtemplater(zip);\n      doc.setData(dataToRender);\n      doc.render();\n\n      // Генерируем файл и сохраняем его\n      const output = doc.getZip().generate({\n        type: 'blob'\n      });\n      saveAs(output, `Протокол_${item.student.last_name}_${item.student.first_name}.docx`);\n    }\n  } catch (error) {\n    console.error('Ошибка загрузки файла:', error);\n  }\n};\nexport default generateProtocolsFunction;","map":{"version":3,"names":["petrovich","saveAs","PizZip","Docxtemplater","word","generateProtocolsFunction","composition_of_sec","selectedGroup","groupData","data","requests","chairman","member_of_SEC","find","comp","chairman_of_SEC","members_list","filter","sec","response","fetch","ok","Error","arrayBuffer","item","request","request_list","req","student","username","user","console","warn","last_name","first_name","personalProtection","personal_work_protection_list","pp","id","generalProtection","general_work_protection_list","gp","work_protection","teacher","theme","hours_start","min_start","time","split","startTime","Date","setHours","setMinutes","getMinutes","hours_end","getHours","min_end","dataToRender","protocol_number","group_protection_date","date","toLocaleDateString","chairman_last_name","chairman_np","getInitials","patronymic","chairman_degree","employee_information","academic_degree","chairman_job_title","job_title","map","member","members_last_name","members_np","members_degree","members_job_title","members_place_of_work","place_of_work","student_fullname","specialityCode","group","speciality","code","specialtityProgram","name","teacher_last_name","teacher_np","teacher_degree","teacher_job_title","reviewer_last_name","reviewer","reviewer_np","reviewer_degree","reviewer_job_title","student_last_name","student_np","secretary_last_name","secretary_np","duration","zip","doc","setData","render","output","getZip","generate","type","error"],"sources":["C:/Users/79131/OneDrive/Рабочий стол/хлам/react project/client/src/components/Forms/GenerateProtocols/GenerateProtocolFunction.js"],"sourcesContent":["import petrovich from 'petrovich';\r\nimport { saveAs } from 'file-saver';\r\nimport PizZip from 'pizzip';\r\nimport Docxtemplater from 'docxtemplater';\r\nimport word from './protocol.docx';\r\n\r\nconst generateProtocolsFunction = async ({ \r\n    composition_of_sec, \r\n    selectedGroup,\r\n    groupData,\r\n    data,\r\n    requests\r\n}) => {\r\n    // Извлекаем председателя и членов СЭК\r\n    const chairman = composition_of_sec.member_of_SEC.find(comp => comp.chairman_of_SEC === true);\r\n    const members_list = composition_of_sec.member_of_SEC.filter(sec => sec.chairman_of_SEC === false);\r\n\r\n    try {\r\n        // Загружаем шаблон документа\r\n        const response = await fetch(word); // Путь к вашему файлу шаблона\r\n        if (!response.ok) throw new Error('Ошибка сети');\r\n        const arrayBuffer = await response.arrayBuffer();\r\n\r\n        // Проходимся по каждому элементу groupData (предполагаем, что это массив)\r\n        for (const item of groupData) {\r\n            const request = requests.request_list.find(req => req.student.username === item.student.user.username);\r\n\r\n            if (!request) {\r\n                console.warn(`Для студента ${item.student.last_name} ${item.student.first_name} не найдена принятая заявка.`);\r\n                continue; // Пропускаем студента без принятой заявки\r\n            }\r\n\r\n            const personalProtection = requests.personal_work_protection_list.find(pp => pp.request === request.id);\r\n\r\n            if (!personalProtection) {\r\n                console.warn(`Для студента ${item.student.last_name} ${item.student.first_name} не найдена персональная защита.`);\r\n                continue; // Пропускаем студента без персональной защиты\r\n            }\r\n\r\n            const generalProtection = requests.general_work_protection_list.find(gp => gp.id === personalProtection.work_protection);\r\n\r\n            if (!generalProtection) {\r\n                console.warn(`Для студента ${item.student.last_name} ${item.student.first_name} не найдена общая защита.`);\r\n                continue; // Пропускаем студента без общей защиты\r\n            }\r\n\r\n            const teacher = request.teacher;\r\n            const theme = request.theme;\r\n\r\n            // Вычисляем время начала и окончания защиты\r\n            const [hours_start, min_start] = personalProtection.time.split(':');\r\n            const startTime = new Date();\r\n            startTime.setHours(hours_start);\r\n            startTime.setMinutes(min_start);\r\n            startTime.setMinutes(startTime.getMinutes() + 20);\r\n\r\n            const hours_end = startTime.getHours();\r\n            const min_end = startTime.getMinutes();\r\n\r\n            // Формируем объект с данными для подстановки в шаблон\r\n            const dataToRender = {\r\n                protocol_number: generalProtection.protocol_number,\r\n                group_protection_date: new Date(generalProtection.date).toLocaleDateString('ru-RU'),\r\n                hours_start: hours_start,\r\n                min_start: min_start,\r\n                hours_end: hours_end,\r\n                min_end: min_end,\r\n                chairman_last_name: chairman.user.last_name,\r\n                chairman_np: getInitials(chairman.user.first_name, chairman.user.patronymic),\r\n                chairman_degree: chairman.employee_information.academic_degree,\r\n                chairman_job_title: chairman.employee_information.job_title,\r\n                members_list: members_list.map(member => ({\r\n                    members_last_name: member.user.last_name,\r\n                    members_np: getInitials(member.user.first_name, member.user.patronymic),\r\n                    members_degree: member.employee_information.academic_degree || '',\r\n                    members_job_title: member.employee_information.job_title,\r\n                    members_place_of_work: member.employee_information.place_of_work,\r\n                })),\r\n                student_fullname: `${item.student.last_name} ${item.student.first_name} ${item.student.patronymic}`,\r\n                specialityCode: item.student.group.speciality.code,\r\n                specialtityProgram: item.student.group.speciality.name,\r\n                theme: theme ? theme.name : '',\r\n                teacher_last_name: teacher.last_name,\r\n                teacher_np: getInitials(teacher.first_name, teacher.patronymic),\r\n                teacher_degree: teacher.employee_information.academic_degree,\r\n                teacher_job_title: teacher.employee_information.job_title,\r\n                reviewer_last_name: theme && theme.reviewer ? theme.reviewer.user.last_name : '',\r\n                reviewer_np: theme && theme.reviewer ? getInitials(theme.reviewer.user.first_name, theme.reviewer.user.patronymic) : '',\r\n                reviewer_degree: theme && theme.reviewer ? theme.reviewer.employee_information.academic_degree : '',\r\n                reviewer_job_title: theme && theme.reviewer ? theme.reviewer.employee_information.job_title : '',\r\n                student_last_name: item.student.last_name,\r\n                student_np: getInitials(item.student.first_name, item.student.patronymic),\r\n                secretary_last_name: data.user.last_name,\r\n                secretary_np: getInitials(data.user.first_name, data.user.patronymic),\r\n                duration: 20,\r\n            };\r\n\r\n            // Создаем новую инстанцию Docxtemplater для каждого студента\r\n            const zip = new PizZip(arrayBuffer);\r\n            const doc = new Docxtemplater(zip);\r\n\r\n            doc.setData(dataToRender);\r\n            doc.render();\r\n\r\n            // Генерируем файл и сохраняем его\r\n            const output = doc.getZip().generate({ type: 'blob' });\r\n            saveAs(output, `Протокол_${item.student.last_name}_${item.student.first_name}.docx`);\r\n        }\r\n    } catch (error) {\r\n        console.error('Ошибка загрузки файла:', error);\r\n    }\r\n};\r\n\r\nexport default generateProtocolsFunction;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}